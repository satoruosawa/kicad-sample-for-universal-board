# pnp トランジスタのスイッチ回路2
### 計算
- 例1
  - DC Forward Current(標準電流): 30mA, Vf: 3.1V(Vfmax:3.6V)の高輝度LED(OSR5JA3Z74A)の場合
  - Vcc: 12V
  - 2段目
    - 2A1015GR(PNP)
    - 2SA1015GRはhfe: 300, ベースエミッタ間飽和電圧Vbe(sat): -1.1V(実測-0.7V), Ic(max) = 150mA
    - トランジスタのＢに流す電流I3(Ib)は、30mA / 300 = 0.1mA, 2倍程度の余裕をもたせて0.2mAとする。(hFEは温度特性があるため、2~3倍程度の余裕をもたせて計算)
    - R3 = (12V - Vo1) / I3
    - トランジスタAのベースがHIGHのとき、CE間の抵抗値が急激に下がり、Icは飽和する。Vo1 = 約0Vとなる。
    - R3 = (12V - 0V) / 0.2mA = 60kΩ
    - 小さめの10kΩなどを使う。このとき、I3には1.2mAが流れることになる。
    - Vcc: 12Vとすると、
      - R4 = (12V - 3.1V) / 30mA = 297Ω
      - R4を220Ωとすると最大8.9V * 8.9V / 220Ω = 360mWとなる。R4は220Ω 1/2Wカーボン抵抗などを使う。
  - 1段目
    - 2SC1815GR(NPN)
    - 2SA1815GRはhfe: 300, ベースエミッタ間飽和電圧Vbe(sat): 1V, Ic(max) = 150mA
    - R1の決定
      - 特に考えず、10kΩでいいという記事もあった気がする。以下、実際に検討してみる。
      - トランジスタAのコレクタ電流Icには I3 + I2 の電流が流れることになる。
      - 動作時にI3は1.2mAであるため、Icは最低でもそれ以上の電流が流せる必要がある。
      - 1.2mA / 300 = 4uA
      - Ib > 4uA
      - <=> (5V - Vbe) / R1 > 4uA
      - <=> (5V - 1V) / R1 > 4uA
      - <=> R1 < 1MΩ
      - 適度なIbとなるようにR1を選択する。小さすぎると増幅しきれず、大きすぎるとマイコンにダメージ（Arduino Unoでは1ピンあたり40mA以上流すと壊れる）
      - R1 = **10kΩ**
    - R2の決定
      - R2が小さ過ぎると電流がR3側に流れず、R2側に流れてしまう。R2側に流れるように、十分に大きいR2を選択する。
      - I2 + I3 < 300 * I1
      - <=> 12V / R2 + (12V + Vbe2) / R3 < 300 * (5V - 1V) / R1 ※Vbe2: 2段目のVbe
      - <=> 12V / R2 + 10.9V / 10kΩ < 300 * 4V / 10kΩ
      - <=> 12V / R2 < 120mA - 1mA
      - <=> R2 > 101Ω
      - ということで、ここでは、R2 = 10kΩとする。

- 例2
  - DC Forward Current(max): 1500mA, Vf: 2.95V(Vfmax:3.25V)のパワーLED(XGPWHT 5w)に2.75V100mAを流す場合
  - Vcc: 12V
  - 2段目
    - 2A1015GR(PNP)
    - 2SA1015GRはhfe: 300, ベースエミッタ間飽和電圧Vbe(sat): -1.1V(実測-0.7V), Ic(max) = 150mA
    - トランジスタのＢに流す電流I3(Ib)は、100mA / 300 = 0.33mA, 2倍程度の余裕をもたせて0.6mAとする。(hFEは温度特性があるため、2~3倍程度の余裕をもたせて計算)
    - R3 = (12V - Vo1) / I3
    - R2がよっぽど小さくない限り、Icは振り切れて、Vo1 = 0Vとなる。
    - R3 = (12V - 0V) / 0.6mA = 20kΩ
    - 小さめの10kΩなどを使う。
    - Vcc: 12Vとすると、
      - R4 = (12V - 2.95V) / 100mA = 91Ω
      - R4を100Ωとすると最大9.05V * 9.05V / 100Ω = 820mWとなる。R4は100Ω 1Wカーボン抵抗などを使う。
  - 1段目
    - 2SC1815GR(NPN)
    - 2SA1815GRはhfe: 300, ベースエミッタ間飽和電圧Vbe(sat): 1V, Ic(max) = 150mA
    - (2SC1815GRの)Ic - Vce 特性から、十分なIcが得られそうなIbのうち、最小（少なめ）のものを選ぶ。Ib = 0.5mAとする。
    - R1 = 10kΩ
    - R2がよっぽど小さくない限り、Icは振り切れて、Vo1 = 0Vとなる。
    - I2 + I3 < 300 * I1
    - <=> 12V / R2 + (12V + Vbe2) / R3 < 300 * (5V - 1V) / R1 ※Vbe2: 2段目のVbe
    - <=> 12V / R2 + 10.9V / 10kΩ < 300 * 4V / 10kΩ
    - <=> 12V / R2 < 120mA - 1mA
    - <=> R2 > 101Ω
    - ということで、ここでは、R2 = 10kΩとする。

### *
- 基本的に計算しないといけないのはR4だけ。R1, R2, R3 は全部10kΩとかで良さそう。
